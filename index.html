<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Codex - Your AI</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav>
      <a href="#" id="logout_link">Logout</a>
      <a href="#" id="profile_link">Profile</a>
      <a href="#" id="chat_link">Chat</a>
    </nav>
    <div id="app">
      <div id="login_container" style="display:none">
        <h1>Log In Codex</h1>
        <form id="login_form">
          <label for="username">Username:</label>
          <input type="text" id="username" name="username" required>

          <label for="password">Password:</label>
          <input type="password" id="password" name="password" required>

          <button type="submit">Log In</button>
        </form>
        <p>Don't have an account yet? <a href="#" id="signin_link">Sign up</a></p>
      </div>

      <div id="signin_container" style="display:none">
        <h1>Sign In Codex</h1>
        <form id="signin_form">
          <label for="username">Username:</label>
          <input type="text" id="signusername" name="username" required>

          <label for="password">Password:</label>
          <input type="password" id="signpassword" name="password" required>

          <button type="submit">Sign In</button>
        </form>
        <p>Already have an account? <a href="#" id="login_link">Log in</a></p>
      </div>

      <div id="app_layout">

        <div id="side_bar">
          <div id="file_list">
            <form id="uploadForm">
              <div id="file_selector">
                <button type="button">选择文件</button>
                <input type="file" id="fileInput" />
              </div>
              <div id="fileName">文件名</div>
              <button type="button" id="uploadFile">分析</button>
            </form>
          </div>
          <div id="file_content_area">
            <img id="image_content" style="max-width: 100%; height: auto;" />
            <textarea id="file_content" rows=40 placeholder="文件预览..."></textarea>
            <div id="fade-effect"></div>
          </div>
        </div>

        <div id="analysis_container">
          <div id="loadingIndicator" style="display:none;">分析文章中<span id="loadingDots"></span></div>
          <div id="analysis_result"></div>
          <div id="chartsContainer"></div>
          <div id="justifications"></div>
          <div id="recommendations"></div>
          <div id="analysis_alter_images">
            <div id="alter_images">
              <canvas id="altered_image_canvas" width="800" height="400">
                浏览器不支持canvas
                <!-- canvas标签内的内容只有在浏览器不支持canvas的情况下才显示出来 -->
              </canvas>
              <div id="alter_image_controls">
                <br/>
                <div id="pencilBtn" class="button">Pencil</div>
                <div id="eraserBtn" class="button">Eraser</div>
                <div id="clearBtn" class="button">Clear</div>
                <label for="strokeColorSelect">画笔颜色:</label>
                <select id="strokeColorSelect">
                    <option value="black">黑色</option>
                    <option value="blue">蓝色</option>
                    <option value="green">绿色</option>
                    <option value="yellow">黄色</option>
                    <option value="red">红色</option>
                </select>
                <br/>
                <label for="strokeLineWidth">线条宽度:</label>
                <input type="number" id="strokeLineWidth">
              </div>
            </div>
            <form id="alter_image_form">
              <textarea id="image_comments" name="comments" rows="10" placeholder="补充说明..."></textarea>
              <button id="submit_to_analysis" type="submit">分析图片</button>
            </form>
          </div>
        </div>

        <div id="chat_container" style="display:none">
          <div id="message_container"></div>
          <form id="chat_form">
            <textarea name="prompt" rows="1" cols="1" placeholder="Ask Codex..."></textarea>
            <button type="submit"><img src="assets/send.svg" alt="send" /></button>
          </form>
        </div>
      </div>

    <script type="module" src="auth.js"></script>
    <script type="module" src="chat.js"></script>
    <script type="module" src="upload.js"></script>
    <script type="module" src="canvas.js"></script>
    <script>
      const signinLink = document.getElementById("signin_link");
      const loginLink = document.getElementById("login_link");
      const toggleChat = document.getElementById("chat_link");
      const loginContainer = document.getElementById("login_container");
      const signinContainer = document.getElementById("signin_container");
      const chatContainer = document.getElementById("chat_container");


      signinLink.addEventListener("click", (event) => {
        event.preventDefault();
        loginContainer.style.display = "none";
        signinContainer.style.display = "block";
      });

      loginLink.addEventListener("click", (event) => {
        event.preventDefault();
        signinContainer.style.display = "none";
        loginContainer.style.display = "block";
      });

      // Add a click event listener to the profile link
      toggleChat.addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the default behavior of the link
        // Your profile code here
        if (localStorage.getItem('jwtToken')){
          chatContainer.style.display === "flex" ? chatContainer.style.display = "none" : chatContainer.style.display = "flex";
        } else alert("Please login first!");
        //console.log("toggleChat clicked!");
      });

      /*
      // Listen for the beforeunload event
      window.addEventListener('beforeunload', () => {
      // Remove the JWT token from local storage
        localStorage.removeItem('jwtToken');
      })
      window.addEventlist('')
      */
    </script>
  </body>
</html>
